<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H·ªá Th·ªëng Th∆∞ Vi·ªán</title>
    <style>
        body { font-family: sans-serif; container: 800px; margin: auto; padding: 20px; }
        .book { border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; border-radius: 5px; }
        .book button { margin-left: 10px; }
        #add-book-form { margin-top: 20px; padding: 15px; border: 1px solid #007bff; border-radius: 5px; }
    </style>
</head>
<body>

    <h1>üìö Danh S√°ch S√°ch</h1>
    <div id="book-list"></div>

    <hr>

    <div id="add-book-form">
        <h3>Th√™m S√°ch M·ªõi</h3>
        <input type="text" id="title" placeholder="T√™n s√°ch" required>
        <input type="text" id="author" placeholder="T√°c gi·∫£" required>
        <input type="number" id="quantity" placeholder="S·ªë l∆∞·ª£ng" required>
        <button onclick="addBook()">Th√™m S√°ch</button>
    </div>

    <script>
        const API_URL = '/api';

        // H√†m g·ªçi API ƒë·ªÉ l·∫•y v√† hi·ªÉn th·ªã danh s√°ch s√°ch
        async function fetchBooks() {
            const response = await fetch(`${API_URL}/books`);
            const books = await response.json();
            const bookListDiv = document.getElementById('book-list');
            bookListDiv.innerHTML = ''; // X√≥a danh s√°ch c≈©

            books.forEach(book => {
                const bookDiv = document.createElement('div');
                bookDiv.className = 'book';
                bookDiv.innerHTML = `
                    <strong>${book.title}</strong> - <em>${book.author}</em>
                    <br>
                    <span>S·ªë l∆∞·ª£ng c√≤n l·∫°i: ${book.quantity}</span>
                    <button onclick="borrowBook(${book.id})" ${book.quantity <= 0 ? 'disabled' : ''}>M∆∞·ª£n</button>
                    <button onclick="returnBook(${book.id})">Tr·∫£</button>
                `;
                bookListDiv.appendChild(bookDiv);
            });
        }

        // H√†m g·ªçi API ƒë·ªÉ th√™m s√°ch m·ªõi
        async function addBook() {
            const title = document.getElementById('title').value;
            const author = document.getElementById('author').value;
            const quantity = parseInt(document.getElementById('quantity').value);

            await fetch(`${API_URL}/books`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ title, author, quantity })
            });

            // L√†m m·ªõi l·∫°i danh s√°ch s√°ch
            fetchBooks();
        }

        // H√†m g·ªçi API m∆∞·ª£n s√°ch
        async function borrowBook(bookId) {
            const response = await fetch(`${API_URL}/borrow`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ book_id: bookId })
            });
            const result = await response.json();
            if (response.ok) {
                alert(result.message);
            } else {
                alert(`L·ªói: ${result.error}`);
            }
            fetchBooks();
        }

        // H√†m g·ªçi API tr·∫£ s√°ch
        async function returnBook(bookId) {
            await fetch(`${API_URL}/return`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ book_id: bookId })
            });
            fetchBooks();
        }

        // T·∫£i danh s√°ch s√°ch khi trang ƒë∆∞·ª£c m·ªü
        window.onload = fetchBooks;
    </script>

</body>
</html>